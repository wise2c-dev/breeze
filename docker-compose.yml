version: '2'
services:
  deploy:
    container_name: deploy-main
    image: wise2c/pagoda:v1.2.0
    restart: always
    entrypoint: sh
    command:
    - -c
    - "/root/pagoda -logtostderr -v 4 -w /workspace"
    ports:
    - 88:80
    - 8088:8080
    volumes:
    - $HOME/.ssh:/root/.ssh
    - $PWD/deploy:/deploy
    volumes_from:
    - playbook
  ui:
    container_name: deploy-ui
    image: wise2c/deploy-ui:v1.6
    restart: always
    network_mode: "service:deploy"
  playbook:
    container_name: deploy-playbook
    image: wisecloud/playbook:v1.15.3
    volumes:
    - playbook:/workspace
  yum-repo:
    container_name: deploy-yumrepo
    image: wisecloud/yum-repo:v1.15.3
    ports:
    - 2009:2009 
    restart: always
  pip-repo:
    container_name: deploy-piprepo
    image: wisecloud/pip-repo:v0.1.0
    ports:
    - 2008:8080
    restart: always
volumes:
  playbook:
    external: false
